let i=1200,p=20*60,f=!1,v,L="Focus",a={Focus:0,Quick:0,Deep:0},d=[],l="en",r="light";const C={en:{welcome:{title:"Take a moment",subtitle:"Regular reminders for better posture"},modes:{focus:"Focus (20m)",quick:"Quick (5m)",deep:"Deep (45m)"},timer:{sessions:"Sessions"},controls:{start:"Start",pause:"Pause",reset:"Reset"},sidebar:{currentFocus:"Current focus",focusPlaceholder:"What are you working on?",progress:"Today's progress",history:"Focus history"},stats:{focus:"Focus",quick:"Quick",deep:"Deep",total:"Total"},notification:{title:"Posture check",description:"Take a deep breath, roll your shoulders back, and adjust your posture. Your body will thank you.",continue:"Continue"},focusHistory:{prefix:"You focused on: "}},es:{welcome:{title:"Tómate un momento",subtitle:"Recordatorios regulares para mejor postura"},modes:{focus:"Enfoque (20m)",quick:"Rápido (5m)",deep:"Profundo (45m)"},timer:{sessions:"Sesiones"},controls:{start:"Iniciar",pause:"Pausar",reset:"Reiniciar"},sidebar:{currentFocus:"Enfoque actual",focusPlaceholder:"¿En qué estás trabajando?",progress:"Progreso de hoy",history:"Historial de enfoque"},stats:{focus:"Enfoque",quick:"Rápido",deep:"Profundo",total:"Total"},notification:{title:"Revisa tu postura",description:"Respira profundo, echa los hombros hacia atrás y ajusta tu postura. Tu cuerpo te lo agradecerá.",continue:"Continuar"},focusHistory:{prefix:"Te enfocaste en: "}}},s=e=>document.getElementById(e),F=s("time-display"),c=s("control-btn"),k=s("progress-ring"),w=s("notification"),P=s("session-count"),x=document.querySelectorAll(".mode-btn"),y=s("focus-input"),T=s("focus-history-list"),S=new Audio("/sounds/ding.mp3"),A=s("closeBtn");S.volume=1;S.load();function b(){const e={counts:a,focusHistory:d,timestamp:Date.now()};localStorage.setItem("postureHelperData",JSON.stringify(e))}function N(){const e=localStorage.getItem("postureHelperData");if(e)try{const t=JSON.parse(e),o=Date.now(),n=24*60*60*1e3;if(t.timestamp&&o-t.timestamp<n)return a=t.counts||{Focus:0,Quick:0,Deep:0},d=t.focusHistory||[],!0}catch(t){console.log("Error loading from localStorage:",t)}return!1}function E(){localStorage.removeItem("postureHelperData")}function j(){return sessionStorage.getItem("pageRefreshed")==="true"}function B(){sessionStorage.setItem("pageRefreshed","true")}function u(e){const t=e.split(".");let o=C[l];for(const n of t)if(o&&o[n])o=o[n];else{o=C.en;for(const h of t)o=o[h];break}return o||e}function I(){document.querySelectorAll("[data-i18n]").forEach(t=>{const o=t.getAttribute("data-i18n"),n=u(o);n&&(t.textContent=n)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const o=t.getAttribute("data-i18n-placeholder"),n=u(o);n&&(t.placeholder=n)});const e=document.querySelector(".language-text");e&&(e.textContent=l.toUpperCase()),R(),localStorage.setItem("postureHelperLanguage",l)}function $(){l=l==="en"?"es":"en",I()}function O(){const e=localStorage.getItem("postureHelperLanguage");e&&(e==="en"||e==="es")&&(l=e),I()}function Q(){r=r==="light"?"dark":"light",q()}function q(){const e=document.body,t=document.querySelector(".theme-icon");r==="dark"?(e.classList.add("dark-theme"),t.textContent="🌙"):(e.classList.remove("dark-theme"),t.textContent="☀️"),m(),localStorage.setItem("postureHelperTheme",r)}function M(){const e=localStorage.getItem("postureHelperTheme");e&&(e==="light"||e==="dark")&&(r=e),q()}j()?(N(),R()):(E(),a={Focus:0,Quick:0,Deep:0},d=[]);g();B();O();M();x.forEach(e=>{e.addEventListener("click",()=>{if(f)return;x.forEach(o=>o.classList.remove("active")),e.classList.add("active"),i=p=parseInt(e.dataset.time)*60,L=e.dataset.name,m(),g(),b()})});function m(){const e=String(Math.floor(i/60)).padStart(2,"0"),t=String(i%60).padStart(2,"0");F.textContent=`${e}:${t}`;const o=(p-i)/p*360,n=r==="dark"?"#404040":"#f5f2ed",h=r==="dark"?"#3b82f6":"rgb(0, 0, 0)";k.style.background=`conic-gradient(${h} ${o}deg, ${n} ${o}deg)`}function W(){const e=Object.values(a).reduce((t,o)=>t+o,0);P.textContent=e}function z(){s("focus-count").textContent=a.Focus,s("quick-count").textContent=a.Quick,s("deep-count").textContent=a.Deep,s("total-count").textContent=Object.values(a).reduce((e,t)=>e+t,0)}function g(){W(),z()}function J(){f?H():V()}function V(){f=!0,c.textContent=u("controls.pause"),c.classList.add("pause"),v=setInterval(()=>{i--,m(),i<=0&&Y()},1e3)}function H(){f=!1,c.textContent=u("controls.start"),c.classList.remove("pause"),clearInterval(v)}function Y(){f=!1,clearInterval(v),a[L]++,g(),b(),G(),D()}function D(){const e=document.querySelector(".mode-btn.active");if(!e)return;i=p=parseInt(e.dataset.time)*60,c.textContent=u("controls.start"),c.classList.remove("pause"),r==="dark"?k.style.background="conic-gradient(#3b82f6 0deg, #404040 0deg)":k.style.background="conic-gradient(#d4af8c 0deg, #f5f2ed 0deg)",m()}function G(){w.classList.add("show"),S.play().catch(e=>{console.log("Audio playback failed, using fallback:",e),X()}),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}function K(){H(),Object.keys(a).forEach(e=>a[e]=0),d=[],g(),E(),D()}function U(e){const t=document.createElement("li"),o=document.createTextNode(u("focusHistory.prefix")),n=document.createElement("span");n.style.fontWeight="bold",n.textContent=e,t.appendChild(o),t.appendChild(n),T.appendChild(t),d.push(e),b()}function R(){T.innerHTML="",d.forEach(e=>{const t=document.createElement("li"),o=document.createTextNode(u("focusHistory.prefix")),n=document.createElement("span");n.style.fontWeight="bold",n.textContent=e,t.appendChild(o),t.appendChild(n),T.appendChild(t)})}y.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();const t=y.value.trim();t&&(U(t),y.value="")}});c.addEventListener("click",()=>{window.audioContextInitialized!==!0&&(window.audioContextInitialized=!0),J()});s("reset-btn").addEventListener("click",K);s("language-toggle").addEventListener("click",$);s("theme-toggle").addEventListener("click",Q);A.addEventListener("click",()=>{w.classList.remove("show")});function X(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),o=e.createGain();t.type="sine",t.frequency.value=800,t.connect(o),o.connect(e.destination),o.gain.setValueAtTime(.5,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(),t.stop(e.currentTime+.5)}
